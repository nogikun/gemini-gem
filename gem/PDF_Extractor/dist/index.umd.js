(function(e,Z){typeof exports=="object"&&typeof module<"u"?module.exports=Z(require("react")):typeof define=="function"&&define.amd?define(["react"],Z):(e=typeof globalThis<"u"?globalThis:e||self,e.PDF_Extractor=Z(e.React))})(this,(function(e){"use strict";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),me=(...n)=>n.filter((c,t,i)=>!!c&&c.trim()!==""&&i.indexOf(c)===t).join(" ").trim();/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ye={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=e.forwardRef(({color:n="currentColor",size:c=24,strokeWidth:t=2,absoluteStrokeWidth:i,className:y="",children:$,iconNode:g,...I},B)=>e.createElement("svg",{ref:B,...ye,width:c,height:c,stroke:n,strokeWidth:i?Number(t)*24/Number(c):t,className:me("lucide",y),...I},[...g.map(([L,F])=>e.createElement(L,F)),...Array.isArray($)?$:[$]]));/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=(n,c)=>{const t=e.forwardRef(({className:i,...y},$)=>e.createElement(ve,{ref:$,iconNode:c,className:me(`lucide-${Z(n)}`,i),...y}));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=w("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=w("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=w("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=w("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=w("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=w("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=w("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=w("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=w("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=w("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=w("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=w("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=w("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=w("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=w("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=w("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=w("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),je=[{name:"arXiv:2004.08531 (StyleGAN2-ADA)",url:"https://arxiv.org/pdf/2004.08531.pdf",description:"Training Generative Adversarial Networks with Limited Data"},{name:"MEXT Report (Example)",url:"https://www.mext.go.jp/content/20250715-mxt_soseisk01-000043715_01.pdf",description:"文部科学省サンプルPDF"},{name:"Mozilla PDF.js Sample",url:"https://raw.githubusercontent.com/mozilla/pdf.js/ba2edeae/web/compressed.tracemonkey-pldi-09.pdf",description:"CORS対応確認用サンプル"}],le=n=>new Promise((c,t)=>{if(document.querySelector(`script[src="${n}"]`)){c(!0);return}const i=document.createElement("script");i.src=n,i.onload=()=>c(!0),i.onerror=()=>t(new Error(`Failed to load script: ${n}`)),document.head.appendChild(i)}),Ie=(n,c)=>[n[0]*c[0]+n[1]*c[2],n[0]*c[1]+n[1]*c[3],n[2]*c[0]+n[3]*c[2],n[2]*c[1]+n[3]*c[3],n[4]*c[0]+n[5]*c[2]+c[4],n[4]*c[1]+n[5]*c[3]+c[5]],fe=(n,c)=>{if(!n)return"";let t=n;for(const i in c)t=t.replace(`{${i}}`,String(c[i]));return t},Fe={en:{appTitle:"PDF Workspace",newProject:"New Project",projects:"Projects",uploadTab:"Local File",urlTab:"Web URL",dropFile:"Drop PDF file here",clickToBrowse:"or click to browse",enterUrl:"Enter PDF URL",loadUrl:"Load URL",presets:"Presets / Examples",corsWarning:"Note: Some URLs may require a proxy or manual download due to CORS.",corsError:"Could not load PDF via any available method. Please download the file and upload it manually.",processing:"Processing PDF...",scanning:"Scanning page {current} of {total}",imagesCollected:"{count} images",reset:"Close Project",downloadAll:"Download All",tabGallery:"Gallery",tabManual:"Manual Crop",tabOCR:"References",noImages:"No images collected",switchTabHint:'Switch to "Manual Crop" to extract images manually',addToGallery:"Add to Gallery",dragHint:"Drag to create. Drag corners to resize. Drag inside to move.",showDetected:"Show detected images",blueOutlineHint:"Blue outlines show automatically detected images.",manualBadge:"MANUAL",pagePrefix:"P.",locateTooltip:"Locate in PDF",downloadTooltip:"Download",deleteTooltip:"Delete",copyTooltip:"Copy",copySuccess:"Copied!",copyFail:"Failed to copy.",ocrStart:"Start OCR",ocrStop:"Stop",ocrResultTitle:"References ({count})",ocrRawText:"Raw Text",downloadMarkdown:"MD Download",copyMarkdown:"Copy MD",ocrHint:"Scans for DOIs, arXiv IDs, and URLs.",generating:"Processing...",errorFileType:"Please select a PDF file.",errorParse:"Error parsing PDF.",errorNoImages:"No images found automatically.",errorLoad:"Failed to load libraries.",deleteProject:"Delete Project",noProjects:"No projects yet. Create one to get started!",untitled:"Untitled Project",urlPlaceholder:"https://example.com/file.pdf"},ja:{appTitle:"PDFワークスペース",newProject:"新規プロジェクト",projects:"プロジェクト",uploadTab:"ローカルファイル",urlTab:"Web URL",dropFile:"PDFファイルをドロップ",clickToBrowse:"またはクリックして選択",enterUrl:"PDFのURLを入力",loadUrl:"URLから読み込む",presets:"プリセット / サンプル",corsWarning:"注意: Web上のPDFはセキュリティ制限により直接読み込めない場合があります(自動的に複数のプロキシを試行します)。",corsError:"PDFを読み込めませんでした。手動でダウンロードしてアップロードしてください。",processing:"PDFを処理中...",scanning:"{total} ページ中 {current} ページ目をスキャン中",imagesCollected:"{count} 枚の画像",reset:"閉じる",downloadAll:"一括保存",tabGallery:"ギャラリー",tabManual:"手動切り抜き",tabOCR:"参考文献",noImages:"画像が見つかりません",switchTabHint:"「手動切り抜き」タブから画像を追加してください",addToGallery:"ギャラリーに追加",dragHint:"ドラッグで範囲選択。四隅でサイズ変更、内部ドラッグで移動。",showDetected:"抽出済みの画像を表示",blueOutlineHint:"自動検出された画像の位置を青枠で表示します。",manualBadge:"手動",pagePrefix:"P.",locateTooltip:"PDF内の位置を確認",downloadTooltip:"ダウンロード",deleteTooltip:"削除",copyTooltip:"コピー",copySuccess:"コピーしました！",copyFail:"コピーに失敗しました。",ocrStart:"OCR解析開始",ocrStop:"停止",ocrResultTitle:"参考文献 ({count})",ocrRawText:"解析テキスト",downloadMarkdown:"MD保存",copyMarkdown:"MDコピー",ocrHint:"DOI, arXiv ID, URLを検索してリスト化します。",generating:"処理中...",errorFileType:"PDFファイルを選択してください。",errorParse:"PDFの解析中にエラーが発生しました。",errorNoImages:"自動抽出で画像が見つかりませんでした。",errorLoad:"ライブラリの読み込みに失敗しました。",deleteProject:"プロジェクトを削除",noProjects:"プロジェクトがありません。新規作成してください。",untitled:"無題のプロジェクト",urlPlaceholder:"https://example.com/file.pdf"}};function Ue(){const[n,c]=e.useState(!1),[t,i]=e.useState(!0),[y,$]=e.useState("ja"),[g,I]=e.useState(!1),B=e.useRef(null),[L,F]=e.useState([]),[D,W]=e.useState(null),[O,k]=e.useState(!0),[G,N]=e.useState("local"),[_,ce]=e.useState(""),[K,p]=e.useState(!1),[T,f]=e.useState(""),m=Fe[y];e.useEffect(()=>{(async()=>{try{await le("https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"),await le("https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"),await le("https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"),window.pdfjsLib&&(window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"),c(!0)}catch{f(m.errorLoad)}})()},[m.errorLoad]);const re=(o,u)=>{const x={id:`proj-${Date.now()}`,name:u||m.untitled,data:o,createdAt:new Date,extractedImages:[],ocrPages:[],detectedLinks:[],processed:!1};return F(U=>[...U,x]),W(x.id),x.id},ie=(o,u)=>{o.stopPropagation(),F(x=>x.filter(U=>U.id!==u)),D===u&&W(null)},Q=async o=>{if(o.type!=="application/pdf"){f(m.errorFileType);return}try{const u=await o.arrayBuffer();re(u,o.name),f("")}catch(u){console.error(u),f(m.errorParse)}},ae=async o=>{const u=o||_;if(u){p(!0),f("");try{let x=null;try{const z=await fetch(u);z.ok&&(x=await z.blob())}catch{console.log("Direct fetch failed, trying Proxy 1...")}if(!x)try{const z=`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,M=await fetch(z);M.ok&&(x=await M.blob())}catch{console.log("Proxy 1 failed, trying Proxy 2...")}if(!x)try{const z=`https://corsproxy.io/?${encodeURIComponent(u)}`,M=await fetch(z);M.ok&&(x=await M.blob())}catch{console.log("Proxy 2 failed.")}if(!x)throw new Error("All fetch methods failed");const U=await x.arrayBuffer();let q="downloaded.pdf";try{const M=new URL(u).pathname.split("/"),ne=M[M.length-1];ne&&ne.toLowerCase().endsWith(".pdf")?q=decodeURIComponent(ne):q="web-document.pdf"}catch{}re(U,q)}catch(x){console.warn("URL Load Error (Expected for CORS):",x),f(m.corsError)}finally{p(!1)}}},de=e.useCallback(o=>{F(u=>u.map(x=>x.id===D?{...x,...o}:x))},[D]),R=L.find(o=>o.id===D),h={bg:t?"bg-zinc-950":"bg-zinc-50",text:t?"text-zinc-50":"text-zinc-900",textMuted:t?"text-zinc-400":"text-zinc-500",border:t?"border-zinc-800":"border-zinc-300",card:t?"bg-zinc-900":"bg-white",cardHover:t?"hover:bg-zinc-800":"hover:bg-zinc-100",primary:t?"bg-zinc-100 text-zinc-900 hover:bg-white":"bg-zinc-900 text-zinc-50 hover:bg-zinc-800",secondary:t?"bg-zinc-800 text-zinc-200 hover:bg-zinc-700":"bg-white text-zinc-700 border border-zinc-300 hover:bg-zinc-50",accent:"text-blue-500"};return e.useEffect(()=>{const o=u=>{B.current&&!B.current.contains(u.target)&&I(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]),n?e.createElement("div",{className:`h-screen flex flex-col font-sans overflow-hidden transition-colors duration-300 ${h.bg} ${h.text}`},e.createElement("header",{className:`h-14 shrink-0 border-b ${h.border} flex items-center justify-between px-4 ${h.card}`},e.createElement("div",{className:"flex items-center gap-4"},e.createElement("button",{onClick:()=>k(!O),className:"p-2 rounded-lg hover:bg-zinc-200/50 dark:hover:bg-zinc-800"},e.createElement(Le,{className:"w-5 h-5"})),e.createElement("div",{className:"flex items-center gap-2"},e.createElement("div",{className:`p-1.5 rounded-lg ${t?"bg-zinc-800":"bg-zinc-100"}`},e.createElement(Se,{className:"w-5 h-5"})),e.createElement("h1",{className:"font-bold text-lg hidden md:block"},m.appTitle))),e.createElement("div",{className:"flex items-center gap-2"},e.createElement("div",{className:"relative",ref:B},e.createElement("button",{onClick:()=>I(!g),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium border ${h.border} hover:bg-zinc-200/50 dark:hover:bg-zinc-800`},e.createElement(Me,{className:"w-3.5 h-3.5"}),y==="en"?"EN":"JA"),g&&e.createElement("div",{className:`absolute right-0 mt-2 w-32 rounded-lg shadow-xl border overflow-hidden z-50 ${t?"bg-zinc-900 border-zinc-800":"bg-white border-zinc-200"}`},e.createElement("button",{onClick:()=>{$("en"),I(!1)},className:`w-full text-left px-4 py-2 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-800 ${y==="en"?"font-bold text-blue-500":""}`},"English"),e.createElement("button",{onClick:()=>{$("ja"),I(!1)},className:`w-full text-left px-4 py-2 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-800 ${y==="ja"?"font-bold text-blue-500":""}`},"日本語"))),e.createElement("button",{onClick:()=>i(!t),className:`p-2 rounded-full border ${h.border} hover:bg-zinc-200/50 dark:hover:bg-zinc-800`},t?e.createElement(De,{className:"w-4 h-4"}):e.createElement($e,{className:"w-4 h-4"})))),e.createElement("div",{className:"flex-1 flex overflow-hidden"},e.createElement("div",{className:`${O?"w-64":"w-0"} shrink-0 border-r ${h.border} ${h.card} transition-all duration-300 flex flex-col overflow-hidden`},e.createElement("div",{className:"p-4"},e.createElement("button",{onClick:()=>W(null),className:`w-full py-2 px-3 rounded-lg flex items-center justify-center gap-2 text-sm font-medium transition-colors ${h.primary}`},e.createElement(pe,{className:"w-4 h-4"})," ",m.newProject)),e.createElement("div",{className:"flex-1 overflow-y-auto px-2 pb-4 space-y-1"},e.createElement("div",{className:`px-3 py-2 text-xs font-semibold ${h.textMuted}`},m.projects),L.map(o=>e.createElement("div",{key:o.id,onClick:()=>W(o.id),className:`group flex items-center justify-between px-3 py-2 rounded-lg cursor-pointer text-sm transition-colors ${D===o.id?t?"bg-zinc-800 text-white":"bg-zinc-200 text-zinc-900":`text-zinc-500 hover:${h.text} hover:bg-zinc-100 dark:hover:bg-zinc-800/50`}`},e.createElement("div",{className:"flex items-center gap-3 overflow-hidden"},e.createElement(Ce,{className:`w-4 h-4 shrink-0 ${D===o.id?"text-blue-500":""}`}),e.createElement("span",{className:"truncate"},o.name)),e.createElement("button",{onClick:u=>ie(u,o.id),className:"opacity-0 group-hover:opacity-100 p-1.5 rounded-md hover:bg-zinc-300 dark:hover:bg-zinc-700 text-zinc-500 hover:text-red-500 transition-all",title:m.deleteProject},e.createElement(ge,{className:"w-3.5 h-3.5"})))),L.length===0&&e.createElement("div",{className:`px-4 py-8 text-center text-xs ${h.textMuted}`},m.noProjects))),e.createElement("div",{className:`flex-1 overflow-hidden relative ${h.bg}`},R?e.createElement(Ae,{key:R.id,project:R,updateProjectData:de,theme:h,t:m,isDarkMode:t,closeProject:()=>W(null)}):e.createElement("div",{className:"h-full flex flex-col items-center justify-center p-6 overflow-y-auto"},e.createElement("div",{className:"max-w-2xl w-full space-y-8"},e.createElement("div",{className:"text-center space-y-2"},e.createElement("h2",{className:"text-3xl font-bold"},m.newProject),e.createElement("p",{className:h.textMuted},m.appTitle,"へようこそ。PDFを追加して始めましょう。")),e.createElement("div",{className:`flex p-1 rounded-xl ${t?"bg-zinc-900":"bg-zinc-200"}`},e.createElement("button",{onClick:()=>N("local"),className:`flex-1 py-2.5 rounded-lg text-sm font-medium transition-all ${G==="local"?t?"bg-zinc-800 shadow":"bg-white shadow":"text-zinc-500"}`},m.uploadTab),e.createElement("button",{onClick:()=>N("url"),className:`flex-1 py-2.5 rounded-lg text-sm font-medium transition-all ${G==="url"?t?"bg-zinc-800 shadow":"bg-white shadow":"text-zinc-500"}`},m.urlTab)),e.createElement("div",{className:`min-h-[300px] rounded-2xl border ${h.border} ${h.card} p-8`},G==="local"?e.createElement("div",{className:`
                            h-full min-h-[250px] border-2 border-dashed rounded-xl flex flex-col items-center justify-center gap-4 cursor-pointer transition-colors
                            ${h.border} hover:border-zinc-400 dark:hover:border-zinc-500
                          `,onClick:()=>document.getElementById("file-upload").click(),onDragOver:o=>o.preventDefault(),onDrop:o=>{o.preventDefault(),o.dataTransfer.files[0]&&Q(o.dataTransfer.files[0])}},e.createElement("input",{id:"file-upload",type:"file",accept:"application/pdf",className:"hidden",onChange:o=>o.target.files&&Q(o.target.files[0])}),e.createElement("div",{className:`p-4 rounded-full ${t?"bg-zinc-800":"bg-zinc-100"}`},e.createElement(Te,{className:"w-8 h-8 opacity-50"})),e.createElement("div",{className:"text-center"},e.createElement("p",{className:"font-semibold"},m.dropFile),e.createElement("p",{className:`text-sm ${h.textMuted}`},m.clickToBrowse))):e.createElement("div",{className:"space-y-6"},e.createElement("div",{className:"space-y-2"},e.createElement("label",{className:"text-sm font-medium ml-1"},m.enterUrl),e.createElement("div",{className:"flex gap-2"},e.createElement("input",{type:"text",value:_,onChange:o=>ce(o.target.value),placeholder:m.urlPlaceholder,className:`flex-1 px-4 py-2.5 rounded-lg border ${h.border} bg-transparent outline-none focus:ring-2 ring-blue-500/50`}),e.createElement("button",{onClick:()=>ae(),disabled:!_||K,className:`px-6 rounded-lg font-medium text-sm disabled:opacity-50 flex items-center gap-2 ${h.primary}`},K&&e.createElement(J,{className:"w-4 h-4 animate-spin"}),m.loadUrl)),e.createElement("p",{className:"text-xs text-yellow-600 dark:text-yellow-500 flex items-center gap-1.5 mt-2"},e.createElement(he,{className:"w-3.5 h-3.5"}),m.corsWarning)),e.createElement("div",{className:"space-y-3 pt-4 border-t border-dashed border-zinc-700/50"},e.createElement("h3",{className:`text-xs font-bold uppercase tracking-wider ${h.textMuted}`},m.presets),e.createElement("div",{className:"grid gap-2"},je.map((o,u)=>e.createElement("button",{key:u,onClick:()=>ae(o.url),disabled:K,className:`text-left p-3 rounded-lg border ${h.border} hover:border-blue-500 hover:bg-blue-500/5 transition-all group`},e.createElement("div",{className:"font-medium text-sm group-hover:text-blue-500 flex items-center gap-2"},e.createElement(ue,{className:"w-4 h-4"}),o.name),e.createElement("div",{className:`text-xs mt-1 ${h.textMuted}`},o.url))))))),T&&e.createElement("div",{className:"p-4 rounded-lg bg-red-500/10 text-red-600 dark:text-red-400 text-sm flex items-center gap-3"},e.createElement(he,{className:"w-5 h-5 shrink-0"}),T)))))):e.createElement("div",{className:`min-h-screen flex items-center justify-center ${t?"bg-zinc-950 text-zinc-400":"bg-white text-zinc-500"}`},e.createElement("div",{className:"text-center"},e.createElement(J,{className:"w-8 h-8 animate-spin mx-auto mb-2"}),e.createElement("p",null,"Initializing System...")))}function Ae({project:n,updateProjectData:c,theme:t,t:i,isDarkMode:y,closeProject:$}){const[g,I]=e.useState(null),[B,L]=e.useState(!1),[F,D]=e.useState({current:0,total:0}),[W,O]=e.useState(""),[k,G]=e.useState("auto"),[N,_]=e.useState(1),[ce,K]=e.useState(null),[p,T]=e.useState(null),[f,m]=e.useState(null),[re,ie]=e.useState("default"),[Q,ae]=e.useState(!0),[de,R]=e.useState(1),[h,o]=e.useState(null),[u,x]=e.useState(!1),[U,q]=e.useState(!1),[z,M]=e.useState({current:0,total:0}),[ne,Ye]=e.useState(null),S=e.useRef(null),He=e.useRef(null),Xe=e.useRef(null);e.useRef(null);const[se,be]=e.useState(null);e.useEffect(()=>{if(se){const r=setTimeout(()=>be(null),3e3);return()=>clearTimeout(r)}},[se]),e.useEffect(()=>{let r=!0;return(async()=>{if(n.data&&!(n.processed&&g)){L(!0),O("");try{const s=await window.pdfjsLib.getDocument({data:n.data.slice(0)}).promise;if(!r)return;I(s),n.processed?L(!1):await Be(s)}catch(a){console.error(a),O(i.errorParse),L(!1)}}})(),()=>{r=!1}},[n.id]);const Be=async r=>{const l=r.numPages;D({current:0,total:l});const a=[];for(let s=1;s<=l;s++){D(d=>({...d,current:s}));try{const d=await r.getPage(s),v=await d.getOperatorList(),E=v.fnArray,ee=v.argsArray,C=window.pdfjsLib.OPS;let A=[1,0,0,1,0,0];const V=[],Y=async(b,H,oe)=>{try{if(!b||!b.width||!b.height)return null;const j=document.createElement("canvas");j.width=b.width,j.height=b.height;const X=j.getContext("2d");if(b.bitmap)X.drawImage(b.bitmap,0,0);else if(b.data){const te=X.createImageData(b.width,b.height);b.data.length===b.width*b.height*4?te.data.set(b.data):(X.fillStyle="gray",X.fillRect(0,0,b.width,b.height)),X.putImageData(te,0,0)}return{id:`${s}-${H}-${Math.random().toString(36).substr(2,5)}`,src:j.toDataURL("image/png"),page:s,width:b.width,height:b.height,size:(j.toDataURL("image/png").length*.75/1024).toFixed(1),type:H,pdfTransform:oe}}catch{return null}};for(let b=0;b<E.length;b++){const H=E[b],oe=ee[b];if(H===C.save)V.push(A.slice());else if(H===C.restore)V.length&&(A=V.pop());else if(H===C.transform)A=Ie(oe,A);else if(H===C.paintImageXObject||H===C.paintJpegXObject)try{const j=oe[0],X=await d.objs.get(j);if(X){const te=await Y(X,"xobject",A.slice());te&&a.push(te)}}catch{}}}catch(d){console.warn(d)}}c({extractedImages:a,processed:!0}),L(!1),a.length===0&&O(i.errorNoImages)};e.useEffect(()=>{k==="manual"&&g&&S.current&&Oe(N)},[k,N,g]),e.useEffect(()=>{if(!S.current||k!=="manual")return;const r=()=>{const a=S.current;a&&a.width>0&&R(a.clientWidth/a.width)};r();const l=new ResizeObserver(r);return l.observe(S.current),()=>l.disconnect()},[k,ce]);const Oe=async r=>{if(!g)return;const l=await g.getPage(r),a=l.getViewport({scale:1.5});K(a);const s=S.current,d=s.getContext("2d");s.height=a.height,s.width=a.width,d.fillStyle="white",d.fillRect(0,0,s.width,s.height),await l.render({canvasContext:d,viewport:a}).promise,T(null)},P=10,xe=(r,l,a)=>{if(!a)return null;const{x:s,y:d,width:v,height:E}=a;return Math.abs(r-s)<=P&&Math.abs(l-d)<=P?"nw":Math.abs(r-(s+v))<=P&&Math.abs(l-d)<=P?"ne":Math.abs(r-s)<=P&&Math.abs(l-(d+E))<=P?"sw":Math.abs(r-(s+v))<=P&&Math.abs(l-(d+E))<=P?"se":r>s+P&&r<s+v-P&&l>d+P&&l<d+E-P?"move":null},Ge=r=>{if(!S.current)return;const l=S.current.getBoundingClientRect(),a=r.clientX-l.left,s=r.clientY-l.top,d=xe(a,s,p);d?m({type:d==="move"?"move":"resize",handle:d,startX:a,startY:s,initialCrop:{...p}}):(T({x:a,y:s,width:0,height:0}),m({type:"create",startX:a,startY:s}))},We=r=>{if(!S.current)return;const l=S.current.getBoundingClientRect(),a=r.clientX-l.left,s=r.clientY-l.top;if(f){if(f.type==="create")T({x:Math.min(f.startX,a),y:Math.min(f.startY,s),width:Math.abs(a-f.startX),height:Math.abs(s-f.startY)});else if(f.type==="move"){const d=a-f.startX,v=s-f.startY;T({...f.initialCrop,x:f.initialCrop.x+d,y:f.initialCrop.y+v})}else if(f.type==="resize"){const{initialCrop:d,handle:v}=f,E=a-f.startX,ee=s-f.startY;let C={...d};v==="se"&&(C.width+=E,C.height+=ee),T(C)}}else{const d=xe(a,s,p);ie(d&&d==="move"?"move":"crosshair")}},we=()=>m(null),_e=async()=>{if(!(!p||p.width===0)){x(!0);try{const r=S.current,l=document.createElement("canvas"),a=1/de;l.width=p.width*a,l.height=p.height*a,l.getContext("2d").drawImage(r,p.x*a,p.y*a,p.width*a,p.height*a,0,0,l.width,l.height);const s={id:`man-${Date.now()}`,src:l.toDataURL(),page:N,width:Math.floor(l.width),height:Math.floor(l.height),size:"0",type:"manual",cropRect:{x:p.x*a,y:p.y*a,width:p.width*a,height:p.height*a}};c({extractedImages:[...n.extractedImages,s]}),T(null)}catch(r){console.error(r)}finally{x(!1)}}},qe=async()=>{if(!g||!window.Tesseract)return;q(!0),M({current:0,total:g.numPages});const r=await window.Tesseract.createWorker("eng",1);Xe.current=r;const l=[],a=[];try{for(let s=1;s<=g.numPages;s++){M(Y=>({...Y,current:s}));const d=await g.getPage(s),v=d.getViewport({scale:2}),E=document.createElement("canvas"),ee=E.getContext("2d");E.width=v.width,E.height=v.height,await d.render({canvasContext:ee,viewport:v}).promise;const{data:{text:C}}=await r.recognize(E.toDataURL()),A=[],V=C.match(/https?:\/\/[^\s]+/g);V&&V.forEach(Y=>A.push({type:"URL",value:Y,url:Y,page:s})),l.push({page:s,text:C}),a.push(...A)}c({ocrPages:l,detectedLinks:a})}catch(s){console.error(s),O("OCR Error")}finally{r.terminate(),q(!1)}};if(B)return e.createElement("div",{className:"h-full flex flex-col items-center justify-center p-8 text-center space-y-4"},e.createElement(J,{className:"w-10 h-10 animate-spin text-blue-500"}),e.createElement("div",null,e.createElement("h3",{className:"text-lg font-bold"},i.processing),e.createElement("p",{className:t.textMuted},fe(i.scanning,{current:F.current,total:F.total}))));const Ve=n.extractedImages.filter(r=>r.page===N&&(r.type==="manual"||Q));return e.createElement("div",{className:"h-full flex flex-col"},e.createElement("div",{className:`p-3 shrink-0 border-b ${t.border} flex items-center justify-between gap-4 ${t.card}`},e.createElement("div",{className:"flex items-center gap-3 overflow-hidden"},e.createElement("div",{className:`p-2 rounded-lg ${y?"bg-zinc-800":"bg-zinc-100"}`},e.createElement(ue,{className:"w-4 h-4"})),e.createElement("div",{className:"truncate"},e.createElement("h2",{className:"font-bold text-sm truncate"},n.name),e.createElement("p",{className:`text-xs ${t.textMuted}`},fe(i.imagesCollected,{count:n.extractedImages.length})))),e.createElement("div",{className:"flex items-center gap-2"},e.createElement("div",{className:`flex p-1 rounded-lg ${y?"bg-zinc-800":"bg-zinc-100"}`},e.createElement("button",{onClick:()=>G("auto"),className:`px-3 py-1.5 rounded-md text-xs font-medium ${k==="auto"?y?"bg-zinc-700 shadow text-white":"bg-white shadow text-black":"text-zinc-500"}`},i.tabGallery),e.createElement("button",{onClick:()=>G("manual"),className:`px-3 py-1.5 rounded-md text-xs font-medium ${k==="manual"?y?"bg-zinc-700 shadow text-white":"bg-white shadow text-black":"text-zinc-500"}`},i.tabManual),e.createElement("button",{onClick:()=>G("ocr"),className:`px-3 py-1.5 rounded-md text-xs font-medium ${k==="ocr"?y?"bg-zinc-700 shadow text-white":"bg-white shadow text-black":"text-zinc-500"}`},i.tabOCR)),e.createElement("div",{className:"w-px h-6 bg-zinc-300 dark:bg-zinc-700 mx-1"}),e.createElement("button",{onClick:$,className:"p-2 rounded-lg hover:bg-zinc-200 dark:hover:bg-zinc-800 text-zinc-500",title:i.reset},e.createElement(ge,{className:"w-4 h-4"})))),se&&e.createElement("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-50 px-4 py-2 bg-emerald-600 text-white rounded-full shadow-lg text-sm flex items-center gap-2"},e.createElement(Ee,{className:"w-4 h-4"})," ",se.message),e.createElement("div",{className:"flex-1 overflow-auto bg-zinc-100/50 dark:bg-zinc-950/50 p-4"},k==="auto"&&e.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4"},n.extractedImages.length>0?n.extractedImages.map((r,l)=>e.createElement("div",{key:r.id,className:`group relative aspect-square rounded-xl border ${t.border} ${t.card} overflow-hidden hover:ring-2 ring-blue-500 transition-all`},e.createElement("div",{className:`absolute top-2 left-2 text-[10px] font-bold px-1.5 py-0.5 rounded text-white z-10 ${r.type==="manual"?"bg-emerald-500":"bg-blue-500"}`},"#",l+1),e.createElement("img",{src:r.src,className:"w-full h-full object-contain p-2"}),e.createElement("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2"},e.createElement("button",{onClick:()=>{navigator.clipboard.writeText("dummy"),be({message:i.copySuccess})},className:"p-2 bg-white text-black rounded-lg hover:bg-zinc-200"},e.createElement(ze,{className:"w-4 h-4"})),e.createElement("button",{onClick:()=>{const a=document.createElement("a");a.href=r.src,a.download=`img_${l}.png`,a.click()},className:"p-2 bg-white text-black rounded-lg hover:bg-zinc-200"},e.createElement(Pe,{className:"w-4 h-4"}))))):e.createElement("div",{className:"col-span-full py-20 text-center text-zinc-500"},i.noImages)),k==="manual"&&e.createElement("div",{className:"flex flex-col lg:flex-row gap-6 h-full"},e.createElement("div",{className:"lg:w-64 shrink-0 flex flex-col gap-4"},e.createElement("div",{className:`p-4 rounded-xl border ${t.border} ${t.card} space-y-4`},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("button",{onClick:()=>_(Math.max(1,N-1)),disabled:N<=1,className:`p-2 rounded border ${t.border}`},e.createElement(ke,{className:"w-4 h-4"})),e.createElement("span",{className:"font-mono"},N," / ",g==null?void 0:g.numPages),e.createElement("button",{onClick:()=>_(Math.min(g==null?void 0:g.numPages,N+1)),disabled:N>=(g==null?void 0:g.numPages),className:`p-2 rounded border ${t.border}`},e.createElement(Ne,{className:"w-4 h-4"}))),e.createElement("button",{onClick:_e,disabled:!p||u,className:`w-full py-2 rounded-lg font-bold text-sm flex items-center justify-center gap-2 ${p?t.primary:"bg-zinc-200 dark:bg-zinc-800 text-zinc-400"}`},u?e.createElement(J,{className:"w-4 h-4 animate-spin"}):e.createElement(pe,{className:"w-4 h-4"})," ",i.addToGallery),e.createElement("div",{className:`text-xs p-2 rounded bg-zinc-100 dark:bg-zinc-800 ${t.textMuted}`},i.dragHint)),e.createElement("div",{className:`p-4 rounded-xl border ${t.border} ${t.card}`},e.createElement("label",{className:"flex items-center gap-2 text-sm cursor-pointer"},e.createElement("input",{type:"checkbox",checked:Q,onChange:r=>ae(r.target.checked)}),i.showDetected))),e.createElement("div",{className:"flex-1 overflow-auto flex justify-center p-4 bg-zinc-200/50 dark:bg-zinc-900/50 rounded-xl border border-zinc-200 dark:border-zinc-800"},e.createElement("div",{className:"relative shadow-2xl inline-block",ref:He,style:{cursor:re}},e.createElement("canvas",{ref:S,onMouseDown:Ge,onMouseMove:We,onMouseUp:we,onMouseLeave:we}),p&&e.createElement("div",{className:"absolute border-2 border-white shadow-[0_0_0_9999px_rgba(0,0,0,0.5)] pointer-events-none",style:{left:p.x,top:p.y,width:p.width,height:p.height}}),Ve.map((r,l)=>null)))),k==="ocr"&&e.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-full"},e.createElement("div",{className:`flex flex-col rounded-xl border ${t.border} ${t.card}`},e.createElement("div",{className:"p-3 border-b border-zinc-200 dark:border-zinc-800 flex justify-between items-center"},e.createElement("h3",{className:"font-bold text-sm"},i.ocrResultTitle)),e.createElement("div",{className:"flex-1 overflow-auto p-4 space-y-2"},n.detectedLinks.length>0?n.detectedLinks.map((r,l)=>e.createElement("div",{key:l,className:`p-3 rounded border ${t.border} text-sm`},e.createElement("div",{className:"text-blue-500 font-mono text-xs"},r.type),e.createElement("a",{href:r.url,target:"_blank",rel:"noreferrer",className:"block truncate hover:underline"},r.value))):e.createElement("div",{className:"text-center py-10 text-zinc-500"},i.ocrHint))),e.createElement("div",{className:`flex flex-col rounded-xl border ${t.border} ${t.card}`},e.createElement("div",{className:"p-3 border-b border-zinc-200 dark:border-zinc-800 flex justify-between items-center"},e.createElement("h3",{className:"font-bold text-sm"},i.ocrRawText),e.createElement("button",{onClick:qe,disabled:U,className:`px-3 py-1 rounded text-xs font-bold ${t.primary}`},U?e.createElement(J,{className:"w-3 h-3 animate-spin"}):i.ocrStart)),e.createElement("div",{className:"flex-1 overflow-auto p-4 font-mono text-xs whitespace-pre-wrap"},n.ocrPages.map(r=>e.createElement("div",{key:r.page,className:"mb-4 pb-4 border-b border-zinc-200 dark:border-zinc-800"},e.createElement("div",{className:"font-bold mb-1 opacity-50"},"Page ",r.page),r.text)))))))}return Ue}));

(function(p,j){typeof exports=="object"&&typeof module<"u"?module.exports=j(require("react"),require("lucide-react")):typeof define=="function"&&define.amd?define(["react","lucide-react"],j):(p=typeof globalThis<"u"?globalThis:p||self,p.Video2Manual_Generator=j(p.React,p.Lucide))})(this,(function(p,j){"use strict";var Se={exports:{}},xe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Be;function rt(){if(Be)return xe;Be=1;var be=p,ue=Symbol.for("react.element"),L=Symbol.for("react.fragment"),Q=Object.prototype.hasOwnProperty,C=be.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,J={key:!0,ref:!0,__self:!0,__source:!0};function P(K,_,V){var k,U={},G=null,re=null;V!==void 0&&(G=""+V),_.key!==void 0&&(G=""+_.key),_.ref!==void 0&&(re=_.ref);for(k in _)Q.call(_,k)&&!J.hasOwnProperty(k)&&(U[k]=_[k]);if(K&&K.defaultProps)for(k in _=K.defaultProps,_)U[k]===void 0&&(U[k]=_[k]);return{$$typeof:ue,type:K,key:G,ref:re,props:U,_owner:C.current}}return xe.Fragment=L,xe.jsx=P,xe.jsxs=P,xe}var pe={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var He;function nt(){return He||(He=1,process.env.NODE_ENV!=="production"&&(function(){var be=p,ue=Symbol.for("react.element"),L=Symbol.for("react.portal"),Q=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),J=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),K=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),re=Symbol.for("react.offscreen"),Y=Symbol.iterator,de="@@iterator";function T(e){if(e===null||typeof e!="object")return null;var t=Y&&e[Y]||e[de];return typeof t=="function"?t:null}var O=be.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function h(e){{for(var t=arguments.length,s=new Array(t>1?t-1:0),u=1;u<t;u++)s[u-1]=arguments[u];ve("error",e,s)}}function ve(e,t,s){{var u=O.ReactDebugCurrentFrame,x=u.getStackAddendum();x!==""&&(t+="%s",s=s.concat([x]));var v=s.map(function(m){return String(m)});v.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,v)}}var De=!1,fe=!1,Ne=!1,Ce=!1,M=!1,ye;ye=Symbol.for("react.module.reference");function Te(e){return!!(typeof e=="string"||typeof e=="function"||e===Q||e===J||M||e===C||e===V||e===k||Ce||e===re||De||fe||Ne||typeof e=="object"&&e!==null&&(e.$$typeof===G||e.$$typeof===U||e.$$typeof===P||e.$$typeof===K||e.$$typeof===_||e.$$typeof===ye||e.getModuleId!==void 0))}function W(e,t,s){var u=e.displayName;if(u)return u;var x=t.displayName||t.name||"";return x!==""?s+"("+x+")":s}function he(e){return e.displayName||"Context"}function D(e){if(e==null)return null;if(typeof e.tag=="number"&&h("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Q:return"Fragment";case L:return"Portal";case J:return"Profiler";case C:return"StrictMode";case V:return"Suspense";case k:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case K:var t=e;return he(t)+".Consumer";case P:var s=e;return he(s._context)+".Provider";case _:return W(e,e.render,"ForwardRef");case U:var u=e.displayName||null;return u!==null?u:D(e.type)||"Memo";case G:{var x=e,v=x._payload,m=x._init;try{return D(m(v))}catch{return null}}}return null}var S=Object.assign,ne=0,we,ke,Pe,je,Oe,_e,Me;function Ie(){}Ie.__reactDisabledLog=!0;function Fe(){{if(ne===0){we=console.log,ke=console.info,Pe=console.warn,je=console.error,Oe=console.group,_e=console.groupCollapsed,Me=console.groupEnd;var e={configurable:!0,enumerable:!0,value:Ie,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}ne++}}function Le(){{if(ne--,ne===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:S({},e,{value:we}),info:S({},e,{value:ke}),warn:S({},e,{value:Pe}),error:S({},e,{value:je}),group:S({},e,{value:Oe}),groupCollapsed:S({},e,{value:_e}),groupEnd:S({},e,{value:Me})})}ne<0&&h("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var b=O.ReactCurrentDispatcher,n;function a(e,t,s){{if(n===void 0)try{throw Error()}catch(x){var u=x.stack.trim().match(/\n( *(at )?)/);n=u&&u[1]||""}return`
`+n+e}}var o=!1,d;{var i=typeof WeakMap=="function"?WeakMap:Map;d=new i}function y(e,t){if(!e||o)return"";{var s=d.get(e);if(s!==void 0)return s}var u;o=!0;var x=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var v;v=b.current,b.current=null,Fe();try{if(t){var m=function(){throw Error()};if(Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(F){u=F}Reflect.construct(e,[],m)}else{try{m.call()}catch(F){u=F}e.call(m.prototype)}}else{try{throw Error()}catch(F){u=F}e()}}catch(F){if(F&&u&&typeof F.stack=="string"){for(var f=F.stack.split(`
`),A=u.stack.split(`
`),E=f.length-1,N=A.length-1;E>=1&&N>=0&&f[E]!==A[N];)N--;for(;E>=1&&N>=0;E--,N--)if(f[E]!==A[N]){if(E!==1||N!==1)do if(E--,N--,N<0||f[E]!==A[N]){var z=`
`+f[E].replace(" at new "," at ");return e.displayName&&z.includes("<anonymous>")&&(z=z.replace("<anonymous>",e.displayName)),typeof e=="function"&&d.set(e,z),z}while(E>=1&&N>=0);break}}}finally{o=!1,b.current=v,Le(),Error.prepareStackTrace=x}var ge=e?e.displayName||e.name:"",ce=ge?a(ge):"";return typeof e=="function"&&d.set(e,ce),ce}function c(e,t,s){return y(e,!1)}function R(e){var t=e.prototype;return!!(t&&t.isReactComponent)}function l(e,t,s){if(e==null)return"";if(typeof e=="function")return y(e,R(e));if(typeof e=="string")return a(e);switch(e){case V:return a("Suspense");case k:return a("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case _:return c(e.render);case U:return l(e.type,t,s);case G:{var u=e,x=u._payload,v=u._init;try{return l(v(x),t,s)}catch{}}}return""}var g=Object.prototype.hasOwnProperty,w={},q=O.ReactDebugCurrentFrame;function B(e){if(e){var t=e._owner,s=l(e.type,e._source,t?t.type:null);q.setExtraStackFrame(s)}else q.setExtraStackFrame(null)}function H(e,t,s,u,x){{var v=Function.call.bind(g);for(var m in e)if(v(e,m)){var f=void 0;try{if(typeof e[m]!="function"){var A=Error((u||"React class")+": "+s+" type `"+m+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[m]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw A.name="Invariant Violation",A}f=e[m](t,m,u,s,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(E){f=E}f&&!(f instanceof Error)&&(B(x),h("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",u||"React class",s,m,typeof f),B(null)),f instanceof Error&&!(f.message in w)&&(w[f.message]=!0,B(x),h("Failed %s type: %s",s,f.message),B(null))}}}var Z=Array.isArray;function X(e){return Z(e)}function ae(e){{var t=typeof Symbol=="function"&&Symbol.toStringTag,s=t&&e[Symbol.toStringTag]||e.constructor.name||"Object";return s}}function I(e){try{return ee(e),!1}catch{return!0}}function ee(e){return""+e}function $(e){if(I(e))return h("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",ae(e)),ee(e)}var se=O.ReactCurrentOwner,Ae={key:!0,ref:!0,__self:!0,__source:!0},ie,oe;function Ye(e){if(g.call(e,"ref")){var t=Object.getOwnPropertyDescriptor(e,"ref").get;if(t&&t.isReactWarning)return!1}return e.ref!==void 0}function Ge(e){if(g.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return e.key!==void 0}function Re(e,t){typeof e.ref=="string"&&se.current}function le(e,t){{var s=function(){ie||(ie=!0,h("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};s.isReactWarning=!0,Object.defineProperty(e,"key",{get:s,configurable:!0})}}function Ue(e,t){{var s=function(){oe||(oe=!0,h("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};s.isReactWarning=!0,Object.defineProperty(e,"ref",{get:s,configurable:!0})}}var We=function(e,t,s,u,x,v,m){var f={$$typeof:ue,type:e,key:t,ref:s,props:m,_owner:v};return f._store={},Object.defineProperty(f._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(f,"_self",{configurable:!1,enumerable:!1,writable:!1,value:u}),Object.defineProperty(f,"_source",{configurable:!1,enumerable:!1,writable:!1,value:x}),Object.freeze&&(Object.freeze(f.props),Object.freeze(f)),f};function ze(e,t,s,u,x){{var v,m={},f=null,A=null;s!==void 0&&($(s),f=""+s),Ge(t)&&($(t.key),f=""+t.key),Ye(t)&&(A=t.ref,Re(t,x));for(v in t)g.call(t,v)&&!Ae.hasOwnProperty(v)&&(m[v]=t[v]);if(e&&e.defaultProps){var E=e.defaultProps;for(v in E)m[v]===void 0&&(m[v]=E[v])}if(f||A){var N=typeof e=="function"?e.displayName||e.name||"Unknown":e;f&&le(m,N),A&&Ue(m,N)}return We(e,f,A,x,u,se.current,m)}}var me=O.ReactCurrentOwner,Ee=O.ReactDebugCurrentFrame;function te(e){if(e){var t=e._owner,s=l(e.type,e._source,t?t.type:null);Ee.setExtraStackFrame(s)}else Ee.setExtraStackFrame(null)}var Je;Je=!1;function Ve(e){return typeof e=="object"&&e!==null&&e.$$typeof===ue}function Ze(){{if(me.current){var e=D(me.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function it(e){return""}var $e={};function ot(e){{var t=Ze();if(!t){var s=typeof e=="string"?e:e.displayName||e.name;s&&(t=`

Check the top-level render call using <`+s+">.")}return t}}function Qe(e,t){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var s=ot(t);if($e[s])return;$e[s]=!0;var u="";e&&e._owner&&e._owner!==me.current&&(u=" It was passed a child from "+D(e._owner.type)+"."),te(e),h('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',s,u),te(null)}}function qe(e,t){{if(typeof e!="object")return;if(X(e))for(var s=0;s<e.length;s++){var u=e[s];Ve(u)&&Qe(u,t)}else if(Ve(e))e._store&&(e._store.validated=!0);else if(e){var x=T(e);if(typeof x=="function"&&x!==e.entries)for(var v=x.call(e),m;!(m=v.next()).done;)Ve(m.value)&&Qe(m.value,t)}}}function lt(e){{var t=e.type;if(t==null||typeof t=="string")return;var s;if(typeof t=="function")s=t.propTypes;else if(typeof t=="object"&&(t.$$typeof===_||t.$$typeof===U))s=t.propTypes;else return;if(s){var u=D(t);H(s,e.props,"prop",u,e)}else if(t.PropTypes!==void 0&&!Je){Je=!0;var x=D(t);h("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",x||"Unknown")}typeof t.getDefaultProps=="function"&&!t.getDefaultProps.isReactClassApproved&&h("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function ct(e){{for(var t=Object.keys(e.props),s=0;s<t.length;s++){var u=t[s];if(u!=="children"&&u!=="key"){te(e),h("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",u),te(null);break}}e.ref!==null&&(te(e),h("Invalid attribute `ref` supplied to `React.Fragment`."),te(null))}}var et={};function tt(e,t,s,u,x,v){{var m=Te(e);if(!m){var f="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(f+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var A=it();A?f+=A:f+=Ze();var E;e===null?E="null":X(e)?E="array":e!==void 0&&e.$$typeof===ue?(E="<"+(D(e.type)||"Unknown")+" />",f=" Did you accidentally export a JSX literal instead of a component?"):E=typeof e,h("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",E,f)}var N=ze(e,t,s,x,v);if(N==null)return N;if(m){var z=t.children;if(z!==void 0)if(u)if(X(z)){for(var ge=0;ge<z.length;ge++)qe(z[ge],e);Object.freeze&&Object.freeze(z)}else h("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else qe(z,e)}if(g.call(t,"key")){var ce=D(e),F=Object.keys(t).filter(function(gt){return gt!=="key"}),Xe=F.length>0?"{key: someKey, "+F.join(": ..., ")+": ...}":"{key: someKey}";if(!et[ce+Xe]){var mt=F.length>0?"{"+F.join(": ..., ")+": ...}":"{}";h(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Xe,ce,mt,ce),et[ce+Xe]=!0}}return e===Q?ct(N):lt(N),N}}function ut(e,t,s){return tt(e,t,s,!0)}function dt(e,t,s){return tt(e,t,s,!1)}var ft=dt,ht=ut;pe.Fragment=Q,pe.jsx=ft,pe.jsxs=ht})()),pe}var Ke;function at(){return Ke||(Ke=1,process.env.NODE_ENV==="production"?Se.exports=rt():Se.exports=nt()),Se.exports}var r=at();function st({initialSteps:be=[]}){const[L,Q]=p.useState(null),[C,J]=p.useState(be),[P,K]=p.useState(null),[_,V]=p.useState(!1),[k,U]=p.useState(null),[G,re]=p.useState(!1),[Y,de]=p.useState(!1),[T,O]=p.useState(null),[h,ve]=p.useState(null),[De,fe]=p.useState("default"),[Ne,Ce]=p.useState(null),M=p.useRef(null),ye=p.useRef(null),Te=p.useRef(null),W=p.useRef(null);p.useRef(null),p.useEffect(()=>{if(window.JSZip)re(!0);else{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js",n.async=!0,n.onload=()=>re(!0),document.body.appendChild(n)}},[]);const he=p.useCallback(()=>{if(!M.current)return null;const n=document.createElement("canvas");n.width=M.current.videoWidth,n.height=M.current.videoHeight;const a=n.getContext("2d");return a?(a.drawImage(M.current,0,0,n.width,n.height),n.toDataURL("image/png")):null},[]),D=p.useCallback(async n=>{const a=C.find(o=>o.step_id===n);if(!(!a||!M.current)){if(K(n),de(!1),a.capturedImage){U(a.capturedImage);return}if(L){M.current.currentTime=a.timestamp_seconds,await new Promise(d=>setTimeout(d,300));const o=he();U(o),J(d=>d.map(i=>i.step_id===n?{...i,previewImage:o||void 0}:i))}}},[C,L,he]);p.useEffect(()=>{L&&C.length>0&&P===null&&D(C[0].step_id)},[L,C,P,D]);const S=10,ne=(n,a)=>{n.stopPropagation(),Ce(null),D(a),setTimeout(()=>{de(!0)},100)};p.useEffect(()=>{if(Y&&P&&W.current){const n=C.find(a=>a.step_id===P);if(n&&W.current){const{width:a,height:o}=W.current.getBoundingClientRect(),[d,i,y,c]=n.ui_coordinates;c>0&&y>0?O({x:i/1e3*a,y:d/1e3*o,width:(c-i)/1e3*a,height:(y-d)/1e3*o}):O({x:a*.25,y:o*.4,width:a*.5,height:o*.2})}}},[Y,P,C]);const we=(n,a,o)=>{if(!o)return null;const{x:d,y:i,width:y,height:c}=o;return Math.abs(n-d)<=S&&Math.abs(a-i)<=S?"nw":Math.abs(n-(d+y))<=S&&Math.abs(a-i)<=S?"ne":Math.abs(n-d)<=S&&Math.abs(a-(i+c))<=S?"sw":Math.abs(n-(d+y))<=S&&Math.abs(a-(i+c))<=S?"se":n>d+S&&n<d+y-S&&a>i+S&&a<i+c-S?"move":null},ke=n=>{if(!Y||!W.current)return;const a=W.current.getBoundingClientRect(),o=n.clientX-a.left,d=n.clientY-a.top,i=we(o,d,T);i&&T?ve({type:i==="move"?"move":"resize",handle:i,startX:o,startY:d,initialRect:{...T}}):(O({x:o,y:d,width:0,height:0}),ve({type:"create",startX:o,startY:d,initialRect:null}))},Pe=n=>{if(!Y||!W.current)return;const a=W.current.getBoundingClientRect(),o=n.clientX-a.left,d=n.clientY-a.top,i=Math.max(0,Math.min(o,a.width)),y=Math.max(0,Math.min(d,a.height));if(h){if(h.type==="create")O({x:Math.min(h.startX,i),y:Math.min(h.startY,y),width:Math.abs(i-h.startX),height:Math.abs(y-h.startY)});else if(h.type==="move"&&h.initialRect){const c=i-h.startX,R=y-h.startY;O({...h.initialRect,x:h.initialRect.x+c,y:h.initialRect.y+R})}else if(h.type==="resize"&&h.initialRect){const{initialRect:c,handle:R}=h;let l={...c};const g=i-h.startX,w=y-h.startY;R==="se"?(l.width=c.width+g,l.height=c.height+w):R==="sw"?(l.x=c.x+g,l.width=c.width-g,l.height=c.height+w):R==="ne"?(l.y=c.y+w,l.width=c.width+g,l.height=c.height-w):R==="nw"&&(l.x=c.x+g,l.y=c.y+w,l.width=c.width-g,l.height=c.height-w),l.width<0&&(l.x+=l.width,l.width=Math.abs(l.width)),l.height<0&&(l.y+=l.height,l.height=Math.abs(l.height)),O(l)}}else{const c=we(o,d,T);fe(c==="move"?"move":c==="nw"||c==="se"?"nwse-resize":c==="ne"||c==="sw"?"nesw-resize":"crosshair")}},je=()=>{ve(null)},Oe=()=>{if(P&&T&&W.current){const{width:n,height:a}=W.current.getBoundingClientRect(),o=Math.round(T.x/n*1e3),d=Math.round(T.y/a*1e3),i=Math.round((T.x+T.width)/n*1e3),y=Math.round((T.y+T.height)/a*1e3),c=l=>Math.max(0,Math.min(1e3,l));let R=k;if(!R&&M.current){const l=document.createElement("canvas");l.width=M.current.videoWidth,l.height=M.current.videoHeight;const g=l.getContext("2d");g&&(g.drawImage(M.current,0,0),R=l.toDataURL("image/png"))}J(l=>l.map(g=>g.step_id===P?{...g,ui_coordinates:[c(d),c(o),c(y),c(i)],status:"success",capturedImage:R||void 0}:g)),de(!1),O(null)}},_e=async n=>{var d,i,y,c,R;const a=C.find(l=>l.step_id===n);if(!a)return;let o=a.capturedImage||a.previewImage;if(!o&&M.current&&(M.current.currentTime=a.timestamp_seconds,await new Promise(l=>setTimeout(l,300)),o=he()||void 0),!o){alert("画像の取得に失敗しました。動画を確認してください。");return}J(l=>l.map(g=>g.step_id===n?{...g,status:"analyzing"}:g));try{const l=o.split(",")[1],w=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`
        Return JSON only. No markdown.
        Detect the bounding box of the UI element described by the user.
        Coordinate system: 0-1000 normalized [ymin, xmin, ymax, xmax].
        Schema: { "boxes": [ { "ymin": int, "xmin": int, "ymax": int, "xmax": int, "label": string } ] }
      `+`
Target: ${a.target_label}
Hint: ${a.visual_description}`},{inlineData:{mimeType:"image/png",data:l}}]}],generationConfig:{responseMimeType:"application/json"}})});if(!w.ok)throw new Error(`API Error: ${w.status}`);const B=(R=(c=(y=(i=(d=(await w.json()).candidates)==null?void 0:d[0])==null?void 0:i.content)==null?void 0:y.parts)==null?void 0:c[0])==null?void 0:R.text,H=JSON.parse(B);if(H.boxes&&H.boxes.length>0){const Z=H.boxes[0];J(X=>X.map(ae=>ae.step_id===n?{...ae,ui_coordinates:[Z.ymin,Z.xmin,Z.ymax,Z.xmax],status:"success",capturedImage:o}:ae))}else throw new Error("Not found")}catch(l){console.error(l),alert(`エラーが発生しました: ${l.message}`),J(g=>g.map(w=>w.step_id===n?{...w,status:"error"}:w))}},Me=async()=>{V(!0);for(const n of C)await D(n.step_id),await _e(n.step_id),await new Promise(a=>setTimeout(a,800));V(!1)},Ie=()=>{const n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(C,null,2)),a=document.createElement("a");a.href=n,a.download="result.json",a.click()},Fe=async n=>!n.capturedImage||!n.ui_coordinates?null:new Promise(a=>{const o=new Image;o.onload=()=>{const d=document.createElement("canvas");d.width=o.width,d.height=o.height;const i=d.getContext("2d");if(!i){a(null);return}i.drawImage(o,0,0);const[y,c,R,l]=n.ui_coordinates;if(l>0&&R>0){const g=c/1e3*o.width,w=y/1e3*o.height,q=(l-c)/1e3*o.width,B=(R-y)/1e3*o.height,H=Math.max(2,o.width*.0035),Z=H*2;i.strokeStyle="#ef4444",i.lineWidth=H,i.beginPath(),i.roundRect?i.roundRect(g,w,q,B,Z):i.rect(g,w,q,B),i.stroke();let X=`Step ${n.step_id}`;const ae=12;let I=Math.max(16,o.width*.025);i.font=`bold ${I}px sans-serif`;let ee=i.measureText(X),$=I*.6;const se=q,Ae=ee.width+$*2;if(Ae>se){const ze=se/Ae;let me=Math.floor(I*ze);if(me<ae){X=`${n.step_id}`,I=Math.max(16,o.width*.025),$=I*.6,i.font=`bold ${I}px sans-serif`,ee=i.measureText(X);const Ee=ee.width+$*2;if(Ee>se){const te=se/Ee;I=Math.max(10,Math.floor(I*te))}}else I=me}i.font=`bold ${I}px sans-serif`,ee=i.measureText(X),$=I*.6;const ie=ee.width+$*2,oe=I+$*2,Ye=w<o.height/2,Re=g+q/2-ie/2;let le;Ye?le=w+B+H:le=w-oe-H,i.fillStyle="#ef4444",i.beginPath(),i.roundRect?i.roundRect(Re,le,ie,oe,Z):i.rect(Re,le,ie,oe),i.fill(),i.fillStyle="white",i.textAlign="center",i.textBaseline="middle";const Ue=Re+ie/2,We=le+oe/2;i.fillText(X,Ue,We+I*.05)}d.toBlob(g=>a(g),"image/png")},o.src=n.capturedImage}),Le=async()=>{if(!window.JSZip||!G){alert("ZIPライブラリの準備中です。数秒待ってから再試行してください。");return}V(!0);try{const n=new window.JSZip,a=n.folder("images");let o=`# 操作マニュアル

自動生成された操作手順書です。

`;for(const c of C){if(o+=`### Step ${c.step_id} : ${c.target_label}
`,o+=`${c.instruction_text}

`,c.status==="success"&&c.capturedImage){const R=await Fe(c);if(R){const l=`step${c.step_id}.png`;a==null||a.file(l,R),o+=`![Step ${c.step_id}](./images/${l})

`}}else o+=`> *(画像なし)*

`;o+=`---

`}n.file("manual.md",o);const d=await n.generateAsync({type:"blob"}),i=URL.createObjectURL(d),y=document.createElement("a");y.href=i,y.download="manual_package.zip",y.click(),URL.revokeObjectURL(i)}catch(n){console.error(n),alert("マニュアル作成中にエラーが発生しました。")}finally{V(!1)}},b=C.find(n=>n.step_id===P);return r.jsxs("div",{className:"min-h-screen bg-gray-50 text-gray-900 font-sans flex flex-col",children:[r.jsx("video",{ref:M,src:L||void 0,className:"hidden",muted:!0,playsInline:!0}),r.jsx("input",{type:"file",accept:"video/*",ref:ye,className:"hidden",onChange:n=>{var a;(a=n.target.files)!=null&&a[0]&&Q(URL.createObjectURL(n.target.files[0]))}}),r.jsx("input",{type:"file",accept:".json",ref:Te,className:"hidden",onChange:n=>{var a;if((a=n.target.files)!=null&&a[0]){const o=new FileReader;o.onload=d=>{var i;return J(JSON.parse((i=d.target)==null?void 0:i.result))},o.readAsText(n.target.files[0])}}}),r.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between sticky top-0 z-20 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"bg-blue-600 text-white p-1.5 rounded-lg",children:r.jsx(j.Layout,{className:"w-5 h-5"})}),r.jsx("h1",{className:"font-bold text-lg hidden sm:block",children:"UIキャプチャ・スタジオ"})]}),r.jsxs("div",{className:"flex gap-2 relative",children:[!L&&r.jsxs("button",{onClick:()=>{var n;return(n=ye.current)==null?void 0:n.click()},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors",children:[r.jsx(j.Upload,{className:"w-4 h-4"})," 動画を選択"]}),L&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>{var n;return(n=Te.current)==null?void 0:n.click()},className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg border border-gray-200",title:"JSON読込",children:r.jsx(j.FileJson,{className:"w-5 h-5"})}),r.jsx("div",{className:"h-8 w-px bg-gray-300 mx-1"}),r.jsxs("button",{onClick:Ie,className:"flex items-center gap-2 px-3 py-2 bg-white hover:bg-gray-50 text-gray-700 border border-gray-300 rounded-lg font-medium text-sm transition-colors",children:[r.jsx(j.FileJson,{className:"w-4 h-4"})," ",r.jsx("span",{className:"hidden sm:inline",children:"JSON"})]}),r.jsxs("button",{onClick:Le,disabled:_,className:"flex items-center gap-2 px-4 py-2 bg-indigo-900 hover:bg-indigo-800 text-white rounded-lg font-medium text-sm transition-colors shadow-sm",children:[_?r.jsx(j.Loader2,{className:"w-4 h-4 animate-spin"}):r.jsx(j.BookOpen,{className:"w-4 h-4"}),r.jsx("span",{children:"マニュアル保存 (ZIP)"})]})]})]})]}),r.jsxs("main",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[r.jsxs("div",{className:"w-full md:w-80 bg-white border-b md:border-b-0 md:border-r border-gray-200 flex flex-col h-1/3 md:h-full shrink-0",children:[r.jsxs("div",{className:"p-3 bg-gray-50 border-b border-gray-200 flex justify-between items-center",children:[r.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Timeline Steps"}),r.jsx("span",{className:"bg-gray-200 text-gray-600 text-xs px-2 py-0.5 rounded-full",children:C.length})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:C.map(n=>r.jsxs("div",{className:`group relative rounded-xl border transition-all duration-200 ${P===n.step_id?"bg-blue-50 border-blue-200 shadow-sm ring-1 ring-blue-200":"bg-white border-gray-100 hover:bg-gray-50 hover:border-gray-200"}`,children:[r.jsxs("button",{onClick:()=>D(n.step_id),className:"w-full text-left p-3 flex items-start gap-3",children:[r.jsx("div",{className:`mt-0.5 w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold shrink-0 ${n.status==="success"?"bg-green-100 text-green-700":n.status==="error"?"bg-red-100 text-red-700":P===n.step_id?"bg-blue-600 text-white":"bg-gray-100 text-gray-500"}`,children:n.step_id}),r.jsxs("div",{className:"min-w-0 flex-1",children:[r.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[r.jsx("span",{className:"text-xs font-medium text-gray-900 truncate",children:n.target_label}),r.jsx("span",{className:"text-[10px] text-gray-400 font-mono",children:n.timestamp_str})]}),r.jsx("p",{className:"text-[10px] text-gray-500 line-clamp-1",children:n.instruction_text})]})]}),r.jsxs("div",{className:"absolute top-2 right-2",children:[r.jsx("button",{onClick:a=>{a.stopPropagation(),Ce(Ne===n.step_id?null:n.step_id)},className:"p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-200",children:r.jsx(j.MoreVertical,{className:"w-4 h-4"})}),Ne===n.step_id&&r.jsx("div",{className:"absolute right-0 mt-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden animate-in fade-in zoom-in-95 duration-100",children:r.jsxs("button",{onClick:a=>ne(a,n.step_id),className:"w-full text-left px-4 py-2.5 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 flex items-center gap-2",children:[r.jsx(j.Crop,{className:"w-4 h-4"}),"手動で座標を修正"]})})]})]},n.step_id))}),r.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:r.jsxs("button",{onClick:Me,disabled:_||!L,className:"w-full py-2.5 bg-white border border-gray-300 hover:border-blue-300 hover:text-blue-600 text-gray-700 rounded-lg text-sm font-bold shadow-sm transition-all flex items-center justify-center gap-2 disabled:opacity-50",children:[_?r.jsx(j.Loader2,{className:"w-4 h-4 animate-spin"}):r.jsx(j.Sparkles,{className:"w-4 h-4 text-yellow-500"})," AI一括解析"]})})]}),r.jsx("div",{className:"flex-1 bg-gray-100 flex flex-col h-2/3 md:h-full relative overflow-y-auto",children:L?r.jsxs("div",{className:"p-4 md:p-8 flex flex-col gap-6 max-w-5xl mx-auto w-full h-full",children:[r.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden flex-1 flex flex-col min-h-0 relative",children:[r.jsxs("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(j.Image,{className:"w-4 h-4 text-gray-400"}),r.jsxs("span",{className:"text-sm font-bold text-gray-700",children:["Preview: ",b==null?void 0:b.timestamp_str]}),Y&&r.jsx("span",{className:"bg-orange-100 text-orange-600 text-xs px-2 py-0.5 rounded-full font-bold animate-pulse",children:"Manual Edit Mode"})]}),b&&!Y&&r.jsx("button",{onClick:()=>_e(b.step_id),disabled:_,className:"text-xs bg-blue-50 text-blue-700 px-3 py-1 rounded-full font-medium hover:bg-blue-100 transition-colors",children:b.status==="analyzing"?"解析中...":"AI再解析"}),Y&&r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:()=>{de(!1),O(null)},className:"text-xs bg-gray-100 text-gray-600 px-3 py-1.5 rounded-lg font-bold hover:bg-gray-200 transition-colors flex items-center gap-1",children:[r.jsx(j.X,{className:"w-3 h-3"})," キャンセル"]}),r.jsxs("button",{onClick:Oe,className:"text-xs bg-blue-600 text-white px-3 py-1.5 rounded-lg font-bold hover:bg-blue-700 transition-colors flex items-center gap-1 shadow-sm",children:[r.jsx(j.Save,{className:"w-3 h-3"})," 変更を保存"]})]})]}),r.jsx("div",{className:"flex-1 bg-[url('https://www.transparenttextures.com/patterns/grid-me.png')] bg-gray-50 relative flex items-center justify-center overflow-hidden p-4 select-none",onMouseDown:ke,onMouseMove:Pe,onMouseUp:je,onMouseLeave:je,style:{cursor:De},children:k?r.jsxs("div",{className:"relative shadow-xl max-w-full max-h-full inline-block",children:[r.jsx("img",{ref:W,src:k,alt:"Step Preview",className:"max-w-full max-h-full object-contain rounded pointer-events-none select-none block",draggable:!1}),!Y&&(b==null?void 0:b.ui_coordinates)&&b.ui_coordinates[2]>0&&r.jsx("div",{className:"absolute border-red-500 shadow-[0_0_0_2px_rgba(255,255,255,0.2)] pointer-events-none flex items-center justify-center",style:{top:`${b.ui_coordinates[0]/10}%`,left:`${b.ui_coordinates[1]/10}%`,height:`${(b.ui_coordinates[2]-b.ui_coordinates[0])/10}%`,width:`${(b.ui_coordinates[3]-b.ui_coordinates[1])/10}%`,borderWidth:"3px",borderRadius:"6px"},children:r.jsxs("div",{className:"bg-red-500 text-white px-2 py-0.5 rounded text-[10px] font-bold shadow-sm whitespace-nowrap overflow-hidden max-w-full text-ellipsis",children:["Step ",b.step_id]})}),Y&&T&&r.jsxs("div",{className:"absolute border-2 border-white z-50 shadow-[0_0_0_9999px_rgba(0,0,0,0.5)] cursor-move",style:{left:T.x,top:T.y,width:T.width,height:T.height},children:[r.jsx("div",{className:"absolute -top-1.5 -left-1.5 w-3 h-3 bg-white border border-black cursor-nwse-resize"}),r.jsx("div",{className:"absolute -top-1.5 -right-1.5 w-3 h-3 bg-white border border-black cursor-nesw-resize"}),r.jsx("div",{className:"absolute -bottom-1.5 -left-1.5 w-3 h-3 bg-white border border-black cursor-nesw-resize"}),r.jsx("div",{className:"absolute -bottom-1.5 -right-1.5 w-3 h-3 bg-white border border-black cursor-nwse-resize"})]})]}):r.jsxs("div",{className:"flex flex-col items-center gap-2 text-gray-400",children:[r.jsx(j.Loader2,{className:"w-8 h-8 animate-spin"}),r.jsx("span",{className:"text-sm",children:"Generating Preview..."})]})})]}),b&&!Y&&r.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 shrink-0",children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 block",children:"Target UI Element"}),r.jsxs("div",{className:"flex items-center gap-2 text-lg font-bold text-gray-800",children:[r.jsx(j.MousePointer2,{className:"w-5 h-5 text-blue-500"}),b.target_label]}),r.jsx("p",{className:"text-sm text-gray-600 mt-2 bg-gray-50 p-3 rounded-lg border border-gray-100",children:b.instruction_text})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1 block",children:"AI Hint / Status"}),r.jsxs("p",{className:"text-sm text-gray-600 bg-yellow-50 p-3 rounded-lg border border-yellow-100 text-yellow-800 flex gap-2 items-start",children:[r.jsx(j.Brain,{className:"w-4 h-4 shrink-0 mt-0.5"}),b.visual_description]}),r.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[r.jsxs("div",{className:`text-xs px-2 py-1 rounded font-mono border ${b.status==="success"?"bg-green-50 border-green-200 text-green-700":"bg-gray-100 border-gray-200 text-gray-500"}`,children:["Status: ",b.status||"Pending"]}),r.jsxs("div",{className:"text-xs font-mono text-gray-400",children:["Coords: [",b.ui_coordinates.join(","),"]"]})]})]})]})})]}):r.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400 p-8",children:[r.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mb-4",children:r.jsx(j.Upload,{className:"w-8 h-8 text-gray-400"})}),r.jsx("p",{className:"text-lg font-medium text-gray-500",children:"動画ファイルを読み込んで開始"})]})})]})]})}return st}));
